<div class="search">
    <div class="header">
        <button class="home-btn" routerLink="/dashboard">
            <i class="fas fa-home"></i>
        </button>
        <div class="header-content">
            <h1 class="glow-text">SEARCH</h1>
            <p class="subtitle">FIND PROCEDURES, PARTS & SPECS</p>
            <p class="vehicle-hint" *ngIf="vehicleLabel">Selected: {{ vehicleLabel }}</p>
        </div>
    </div>

    <div class="search-box">
        <input type="text" class="search-input" placeholder="Enter search term..." [(ngModel)]="searchTerm"
            (keyup.enter)="search()" [disabled]="advancedMode">

        <button class="search-btn" (click)="search()" [disabled]="!searchTerm.trim() && !advancedMode">
            <span *ngIf="!loading">SEARCH</span>
            <span *ngIf="loading">...</span>
        </button>

        <button class="clear-btn" (click)="clearSearch()" *ngIf="searchTerm || (advancedMode && searched)">
            CLEAR
        </button>
    </div>

    <div class="advanced-toggle">
        <label class="switch">
            <input type="checkbox" [(ngModel)]="advancedMode" (ngModelChange)="toggleAdvancedMode()">
            <span class="slider round"></span>
        </label>
        <span class="label-text">SHOW ALL ARTICLES</span>
    </div>

    <div *ngIf="!vehicleId" class="warning-message">
        <p>‚ö†Ô∏è No vehicle selected. Please select a vehicle first.</p>
        <button class="select-vehicle-btn" routerLink="/vehicles">SELECT VEHICLE</button>
    </div>

    <div *ngIf="loading" class="loading">
        <div class="spinner"></div>
        <p>SEARCHING...</p>
    </div>

    <div *ngIf="!loading && searched && results.length > 0" class="results">
        <h2>RESULTS ({{ results.length }})</h2>

        <div class="results-list">
            <div *ngFor="let group of groupedResults" class="category-group">
                <div class="category-header" (click)="toggleCategory(group)" [class.expanded]="group.expanded">
                    <h3>{{ group.category }}</h3>
                    <span class="count">{{ group.articles.length }}</span>
                    <span class="arrow">‚ñº</span>
                </div>

                <div class="category-articles" *ngIf="group.expanded">
                    <div *ngFor="let result of group.articles" class="result-card neon-border"
                        (click)="viewArticle(result)">
                        <div class="result-icon">üìÑ</div>
                        <div class="result-info">
                            <h3>{{ result.title }}</h3>
                            <p class="description" *ngIf="result.description">{{ result.description }}</p>
                        </div>
                        <button class="view-btn">VIEW ‚Üí</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="!loading && errorMessage" class="no-results">
        <p style="color: #ff4444;">‚ö†Ô∏è {{ errorMessage }}</p>
        <button class="search-btn" (click)="search()" style="margin-top: 1rem; width: auto;">RETRY</button>
    </div>

    <div *ngIf="!loading && searched && results.length === 0 && !errorMessage" class="no-results">
        <p>No results found for "{{ searchTerm }}"</p>
        <p class="hint">Try a different search term</p>
    </div>
</div>