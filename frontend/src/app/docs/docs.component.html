<div class="docs-container">
    <!-- HUD Header -->
    <div class="hud-header">
        <div class="hud-top-row">
            <div class="back-btn-circle" (click)="changeVehicle()">
                <i class="fas fa-chevron-left"></i>
            </div>
            <h1 class="vehicle-title">{{ vehicleName }}</h1>
            <div class="mini-car-wrapper" #miniCarContainer></div>
        </div>

        <!-- Stat Carousel -->
        <div class="stat-carousel">
            <div class="stat-card" *ngFor="let stat of hudStats">
                <span class="stat-icon">{{ stat.icon }}</span>
                <div class="stat-info">
                    <span class="stat-label">{{ stat.label }}</span>
                    <span class="stat-value">{{ stat.value }}</span>
                </div>
            </div>
            <!-- Loading State for Stats -->
            <div class="stat-card loading" *ngIf="loadingHud">
                <div class="skeleton-line"></div>
                <div class="skeleton-line short"></div>
            </div>
        </div>
    </div>

    <!-- Thumb Zone Navigation (Pills) -->
    <div class="pill-nav-container">
        <div class="pill-scroll-wrapper">
            <button class="nav-pill" *ngFor="let pill of pillFilters" [class.active]="activePill === pill"
                (click)="selectPill(pill)">
                {{ pill }}
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="content-area">
        <!-- Article List (Accordion Style) -->
        <div class="article-list" *ngIf="!viewingArticle">
            <div class="accordion-card" *ngFor="let article of filteredArticles" [class.expanded]="article.expanded">
                <div class="accordion-header" (click)="toggleAccordion(article)">
                    <div class="accordion-title-group">
                        <h3 class="article-title">{{ article.title }}</h3>
                        <span class="article-subtitle" *ngIf="article.subtitle">{{ article.subtitle }}</span>
                    </div>
                    <div class="accordion-meta">
                        <span class="labor-time" *ngIf="article.laborTime">{{ article.laborTime }} Hr</span>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                </div>

                <div class="accordion-body">
                    <div class="action-buttons">
                        <button class="action-btn primary" (click)="viewArticle(article)">
                            <i class="fas fa-file-alt"></i> View Procedure
                        </button>
                        <button class="action-btn secondary" (click)="locateComponent(article)">
                            <i class="fas fa-map-marker-alt"></i> Locate Component
                        </button>
                        <button class="action-btn secondary" (click)="viewParts(article)">
                            <i class="fas fa-cogs"></i> Parts List
                        </button>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="filteredArticles.length === 0 && !loading">
                <i class="fas fa-search"></i>
                <p>No procedures found for "{{ activePill }}"</p>
            </div>

            <!-- Loading State -->
            <div class="loading-state" *ngIf="loading">
                <div class="spinner"></div>
                <p>Loading vehicle data...</p>
            </div>
        </div>

        <!-- Article Viewer -->
        <div class="article-viewer" *ngIf="viewingArticle">
            <div class="viewer-header">
                <button class="close-btn" (click)="closeArticle()">
                    <i class="fas fa-arrow-left"></i> Back to List
                </button>
                <div class="ai-toggle">
                    <span class="ai-label">AI Enhance</span>
                    <label class="switch">
                        <input type="checkbox" [checked]="aiEnhanced" (change)="toggleAiEnhancement()"
                            [disabled]="enhancing">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <div class="viewer-content">
                <div *ngIf="loadingArticle" class="loading-article">
                    <div class="cyber-spinner"></div>
                    <p>{{ loadingMessage }}</p>
                </div>

                <div *ngIf="!loadingArticle" class="article-body" [innerHTML]="articleContent"
                    (click)="handleArticleClick($event)"></div>

                <!-- Labor Data Display -->
                <div *ngIf="laborData && !loadingArticle" class="labor-data-panel">
                    <h3>Labor Operation: {{ laborData.mainOperation.code }}</h3>
                    <div class="labor-details">
                        <div class="labor-row">
                            <span>Description:</span>
                            <strong>{{ laborData.mainOperation.description }}</strong>
                        </div>
                        <div class="labor-row">
                            <span>Time:</span>
                            <strong class="highlight-cyan">{{ laborData.mainOperation.time }} Hours</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FAB Search -->
    <button class="fab-search" (click)="toggleSearchSheet()">
        <i class="fas fa-search"></i>
        <span class="fab-label">Search</span>
    </button>

    <!-- Bottom Search Sheet -->
    <div class="bottom-search-sheet" [class.active]="showSearchSheet">
        <div class="search-header">
            <h3>Global Search</h3>
            <button class="close-sheet" (click)="toggleSearchSheet()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-input-wrapper">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="bottom-search-input" placeholder="Search procedures, parts, specs..."
                [(ngModel)]="searchQuery" (ngModelChange)="onSearchInput()">
        </div>
    </div>

    <!-- Backdrop for Search Sheet -->
    <div class="sheet-backdrop" *ngIf="showSearchSheet" (click)="toggleSearchSheet()"></div>
</div>