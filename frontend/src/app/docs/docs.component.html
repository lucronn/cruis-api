<div class="docs-dashboard-template">
    <!-- Custom Light Beam Background (Matches Dashboard) -->
    <div class="light-beam-container" #lightBeamContainer></div>

    <div class="content-overlay">
        <!-- Header Bar (Floating Glass) -->
        <div class="docs-header">
            <button class="back-btn" (click)="closeArticle()" *ngIf="viewingArticle">
                <i class="fas fa-arrow-left"></i> BACK
            </button>
            <button class="back-btn" routerLink="/search" *ngIf="!viewingArticle">
                <i class="fas fa-arrow-left"></i> BACK TO SEARCH
            </button>

            <div class="vehicle-info-header">
                <div class="mini-car-icon">
                    <div class="mini-car-container" #miniCarContainer></div>
                </div>
                <div class="info-text">
                    <h1 class="glow-text" *ngIf="!loadingName">{{ vehicleName }}</h1>
                    <h1 class="glow-text" *ngIf="loadingName">Loading...</h1>
                    <span class="subtitle">TECHNICAL DOCUMENTATION</span>
                </div>
            </div>

            <button class="change-vehicle-btn" (click)="changeVehicle()">
                CHANGE VEHICLE
            </button>
        </div>

        <!-- Main Content Grid -->
        <div class="docs-grid">

            <!-- Sidebar (Floating Glass Card) -->
            <aside class="sidebar-card" *ngIf="!viewingArticle">
                <div class="sidebar-header">
                    <h2>CATEGORIES</h2>
                </div>

                <div class="search-box">
                    <input type="text" class="search-input" placeholder="Filter categories..." [(ngModel)]="searchQuery"
                        (input)="onSearchChange()">
                </div>

                <div class="categories-list custom-scrollbar">
                    <div *ngFor="let category of categories" class="category-group">
                        <button class="category-btn"
                            [class.active]="selectedCategory?.name === category.name && !selectedSubCategory"
                            (click)="selectCategory(category)">
                            <span class="name">{{ category.name }}</span>
                            <span class="count">{{ category.count }}</span>
                        </button>

                        <div *ngIf="category.subCategories && category.expanded" class="sub-categories">
                            <button *ngFor="let sub of category.subCategories" class="sub-category-btn"
                                [class.active]="selectedSubCategory?.name === sub.name"
                                (click)="selectSubCategory(sub, $event)">
                                <span class="name">{{ sub.name }}</span>
                                <span class="count">{{ sub.articles.length }}</span>
                            </button>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Articles / Content Area (Floating Glass Card) -->
            <main class="content-card" [class.full-width]="viewingArticle" [class.category-selected]="selectedCategory">

                <!-- Article Viewer -->
                <div class="article-viewer" *ngIf="viewingArticle">
                    <div class="article-header-bar">
                        <h2>{{ viewingArticle.title }}</h2>
                        <button class="close-btn" (click)="closeArticle()">âœ•</button>
                    </div>

                    <div class="article-body custom-scrollbar">
                        <div *ngIf="loadingArticle" class="loading-state">
                            <div class="spinner"></div>
                            <p>{{ loadingMessage }}</p>
                        </div>

                        <!-- Labor Data -->
                        <div *ngIf="laborData && !loadingArticle" class="labor-view">
                            <!-- (Existing Labor View Code - Simplified for brevity, keeping logic) -->
                            <div class="labor-header">
                                <h3>{{ laborData.mainOperation.title }}</h3>
                                <p class="subtitle">{{ laborData.mainOperation.subtitle }}</p>
                            </div>
                            <!-- ... Labor Tables ... -->
                            <table class="labor-table">
                                <thead>
                                    <tr>
                                        <th>Operation</th>
                                        <th>Attributes</th>
                                        <th class="align-right">Hours</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <strong>{{ laborData.mainOperation.title }}</strong>
                                            <div *ngIf="laborData.includedOperations?.length > 0" class="included-ops">
                                                <br>+ Included:
                                                <div *ngFor="let inc of laborData.includedOperations">{{ inc.title }}
                                                </div>
                                            </div>
                                        </td>
                                        <td>{{ laborData.vehicleAttributes }}</td>
                                        <td class="align-right">{{ laborData.mainOperation.laborTime | number: '.1-2' }}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- HTML Content -->
                        <div *ngIf="!loadingArticle && !laborData" class="article-html" [innerHTML]="articleContent"
                            (click)="handleArticleClick($event)"></div>
                    </div>
                </div>

                <!-- Articles List -->
                <div class="articles-list-view" *ngIf="!viewingArticle">
                    <div *ngIf="!selectedCategory" class="empty-state">
                        <div class="icon">ðŸ“‘</div>
                        <h2>SELECT A CATEGORY</h2>
                        <p>Choose a category from the left to view articles</p>
                    </div>

                    <div *ngIf="selectedCategory" class="category-view">
                        <div class="category-title-bar">
                            <h2>
                                {{ selectedCategory.name }}
                                <span *ngIf="selectedSubCategory" class="sub-crumb"> > {{ selectedSubCategory.name
                                    }}</span>
                            </h2>
                            <span class="article-count-badge">
                                {{ selectedSubCategory ? selectedSubCategory.articles.length : selectedCategory.count }}
                                ARTICLES
                            </span>
                        </div>

                        <!-- Maintenance Search Form (Preserved) -->
                        <div *ngIf="selectedCategory.name === 'Maintenance Schedules'" class="maintenance-search">
                            <form (ngSubmit)="searchMaintenanceSchedules()" class="search-form">
                                <div class="form-row">
                                    <input type="number" class="interval-input"
                                        [(ngModel)]="maintenanceSchedule.interval" placeholder="Enter interval..."
                                        [disabled]="maintenanceSchedule.intervalType === 'Indicator'">
                                    <button type="submit" class="search-btn" [disabled]="maintenanceSchedule.searching">
                                        {{ maintenanceSchedule.searching ? 'SEARCHING...' : 'SEARCH' }}
                                    </button>
                                </div>
                                <!-- Radio groups preserved but simplified structure -->
                                <div class="radio-groups">
                                    <label><input type="radio" name="intervalType" value="Miles"
                                            [(ngModel)]="maintenanceSchedule.intervalType"> Miles</label>
                                    <label><input type="radio" name="intervalType" value="Kilometers"
                                            [(ngModel)]="maintenanceSchedule.intervalType"> Km</label>
                                    <label><input type="radio" name="intervalType" value="Months"
                                            [(ngModel)]="maintenanceSchedule.intervalType"> Months</label>
                                </div>
                            </form>
                        </div>

                        <!-- Articles Grid -->
                        <div class="articles-grid custom-scrollbar">
                            <ng-container *ngIf="selectedSubCategory">
                                <div *ngFor="let article of selectedSubCategory.articles" class="article-card"
                                    (click)="viewArticle(article)">
                                    <div class="card-icon">ðŸ“„</div>
                                    <div class="card-info">
                                        <h3>{{ article.title || article.id }}</h3>
                                        <p *ngIf="article.subtitle">{{ article.subtitle }}</p>
                                    </div>
                                    <button class="view-btn">VIEW</button>
                                </div>
                            </ng-container>

                            <ng-container *ngIf="!selectedSubCategory">
                                <div *ngFor="let article of selectedCategory.articles" class="article-card"
                                    (click)="viewArticle(article)">
                                    <div class="card-icon">ðŸ“„</div>
                                    <div class="card-info">
                                        <h3>{{ article.title || article.id }}</h3>
                                        <p *ngIf="article.subtitle">{{ article.subtitle }}</p>
                                    </div>
                                    <button class="view-btn">VIEW</button>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
</div>