<div class="docs-container">
    <!-- HUD Header -->
    <div class="hud-header">
        <div class="hud-top-row">
            <div class="back-btn-circle" (click)="changeVehicle()">
                <i class="fas fa-chevron-left"></i>
            </div>
            <h1 class="vehicle-title">{{ vehicleName }}</h1>
            <div class="mini-car-wrapper" #miniCarContainer></div>
        </div>

        <!-- Stat Carousel -->
        <div class="stat-carousel">
            <div class="stat-card" *ngFor="let stat of hudStats">
                <span class="stat-icon">{{ stat.icon }}</span>
                <div class="stat-info">
                    <span class="stat-label">{{ stat.label }}</span>
                    <span class="stat-value">{{ stat.value }}</span>
                </div>
            </div>
            <!-- Loading State for Stats -->
            <div class="stat-card loading" *ngIf="loadingHud">
                <div class="skeleton-line"></div>
                <div class="skeleton-line short"></div>
            </div>
        </div>
    </div>

    <!-- Thumb Zone Navigation (Pills) -->
    <div class="pill-nav-container">
        <div class="pill-scroll-wrapper">
            <button class="nav-pill" *ngFor="let pill of pillFilters" [class.active]="activePill === pill"
                (click)="selectPill(pill)">
                {{ pill }}
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="content-area">
        <!-- Article List (Accordion Style) -->
        <div class="article-list"
            *ngIf="!viewingArticle && activePill !== 'DTCs' && activePill !== 'TSBs' && activePill !== 'Wiring' && activePill !== 'Labor'">
            <div class="accordion-card" *ngFor="let article of filteredArticles" [class.expanded]="article.expanded">
                <div class="accordion-header" (click)="toggleAccordion(article)">
                    <div class="accordion-title-group">
                        <h3 class="article-title">{{ article.title }}</h3>
                        <span class="article-subtitle" *ngIf="article.subtitle">{{ article.subtitle }}</span>
                    </div>
                    <div class="accordion-meta">
                        <span class="labor-time" *ngIf="article.laborTime">{{ article.laborTime }} Hr</span>
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                </div>

                <div class="accordion-body">
                    <!-- Quick Access Info -->
                    <div class="quick-info-grid"
                        *ngIf="article.torqueSpecs || article.partNumber || article.description">
                        <div class="info-item" *ngIf="article.torqueSpecs">
                            <span class="info-label">Torque Spec:</span>
                            <span class="info-value">{{ article.torqueSpecs }}</span>
                        </div>
                        <div class="info-item" *ngIf="article.partNumber">
                            <span class="info-label">Part #:</span>
                            <span class="info-value">{{ article.partNumber }}</span>
                        </div>
                        <div class="info-item" *ngIf="article.description">
                            <span class="info-label">Info:</span>
                            <span class="info-value">{{ article.description }}</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button class="action-btn primary" (click)="viewArticle(article)">
                            <i class="fas fa-eye"></i> VIEW
                        </button>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="filteredArticles.length === 0 && !loading">
                <i class="fas fa-search"></i>
                <p>No procedures found for "{{ activePill }}"</p>
            </div>

            <!-- Loading State -->
            <div class="loading-state" *ngIf="loading">
                <div class="spinner"></div>
                <p>Loading vehicle data...</p>
            </div>
        </div>

        <!-- DTC List -->
        <div class="feature-list dtc-list" *ngIf="activePill === 'DTCs'">
            <div class="feature-card dtc-card" *ngFor="let dtc of dtcData">
                <div class="card-header">
                    <span class="code">{{ dtc.code }}</span>
                    <span class="system">{{ dtc.system }}</span>
                </div>
                <p class="description">{{ dtc.description }}</p>
                <button class="action-btn small" (click)="viewArticle(dtc)">View Diagnostics</button>
            </div>
            <div class="empty-state" *ngIf="dtcData.length === 0 && !loading">
                <i class="fas fa-exclamation-triangle"></i>
                <p>No DTCs found.</p>
            </div>
            <div class="loading-state" *ngIf="loading">
                <div class="spinner"></div>
                <p>Loading DTCs...</p>
            </div>
        </div>

        <!-- TSB List -->
        <div class="feature-list tsb-list" *ngIf="activePill === 'TSBs'">
            <div class="feature-card tsb-card" *ngFor="let tsb of tsbData">
                <div class="card-header">
                    <span class="bulletin-id">{{ tsb.id }}</span>
                    <span class="date">{{ tsb.date }}</span>
                </div>
                <h3 class="title">{{ tsb.title }}</h3>
                <p class="summary">{{ tsb.summary }}</p>
                <button class="action-btn small" (click)="viewArticle(tsb)">View Bulletin</button>
            </div>
            <div class="empty-state" *ngIf="tsbData.length === 0 && !loading">
                <i class="fas fa-clipboard-list"></i>
                <p>No TSBs found.</p>
            </div>
            <div class="loading-state" *ngIf="loading">
                <div class="spinner"></div>
                <p>Loading TSBs...</p>
            </div>
        </div>

        <!-- Wiring Diagrams -->
        <div class="feature-grid wiring-grid" *ngIf="activePill === 'Wiring'">
            <div class="wiring-card" *ngFor="let diagram of wiringData"
                (click)="expandImage(diagram.url, diagram.title)">
                <div class="thumbnail-wrapper">
                    <img [src]="diagram.thumbnail || diagram.url" alt="Wiring Diagram">
                    <div class="overlay"><i class="fas fa-search-plus"></i></div>
                </div>
                <p class="title">{{ diagram.title }}</p>
            </div>
            <div class="empty-state" *ngIf="wiringData.length === 0 && !loading">
                <i class="fas fa-project-diagram"></i>
                <p>No wiring diagrams found.</p>
            </div>
            <div class="loading-state" *ngIf="loading">
                <div class="spinner"></div>
                <p>Loading Diagrams...</p>
            </div>
        </div>

        <!-- Labor Times -->
        <div class="feature-list labor-list" *ngIf="activePill === 'Labor'">
            <div class="labor-table-card">
                <table class="cyber-table">
                    <thead>
                        <tr>
                            <th>Operation</th>
                            <th>Time (Hrs)</th>
                            <th>Skill</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let labor of laborData">
                            <td>{{ labor.operation }}</td>
                            <td class="time">{{ labor.time }}</td>
                            <td>{{ labor.skillLevel }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="empty-state" *ngIf="(!laborData || laborData.length === 0) && !loading">
                <i class="fas fa-stopwatch"></i>
                <p>No labor times found.</p>
            </div>
            <div class="loading-state" *ngIf="loading">
                <div class="spinner"></div>
                <p>Loading Labor Times...</p>
            </div>
        </div>

        <!-- Maintenance View -->
        <div class="feature-list maintenance-list" *ngIf="activePill === 'Maintenance'">
            <div class="maintenance-section">
                <h3><i class="fas fa-calendar-alt"></i> Scheduled Maintenance (30k Miles)</h3>
                <div class="maintenance-grid">
                    <div class="maint-card" *ngFor="let item of maintenanceData.intervals">
                        <div class="maint-icon"><i class="fas fa-wrench"></i></div>
                        <div class="maint-info">
                            <h4>{{ item.serviceName }}</h4>
                            <p>{{ item.action }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="maintenance-section">
                <h3><i class="fas fa-tachometer-alt"></i> Indicator Based</h3>
                <div class="maintenance-grid">
                    <div class="maint-card" *ngFor="let item of maintenanceData.indicators">
                        <div class="maint-icon warning"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="maint-info">
                            <h4>{{ item.indicatorName }}</h4>
                            <p>{{ item.description }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="loading-state" *ngIf="loading">
                <div class="spinner"></div>
                <p>Loading Maintenance Schedules...</p>
            </div>
        </div>

        <!-- Updates / Track Changes -->
        <div class="feature-list updates-list" *ngIf="activePill === 'Updates'">
            <div class="updates-header">
                <label>Select Quarter:</label>
                <select [(ngModel)]="selectedQuarter" (change)="loadDeltaReport(selectedQuarter)">
                    <option *ngFor="let q of trackChangeQuarters" [value]="q">{{ q }}</option>
                </select>
            </div>

            <div class="updates-feed">
                <div class="update-card" *ngFor="let delta of trackChangeDeltas">
                    <div class="update-type" [class.added]="delta.type === 'ADD'"
                        [class.modified]="delta.type === 'MODIFY'">
                        {{ delta.type }}
                    </div>
                    <div class="update-content">
                        <h4>{{ delta.entityType }} - {{ delta.entityId }}</h4>
                        <p>{{ delta.description }}</p>
                    </div>
                </div>
            </div>

            <div class="empty-state" *ngIf="trackChangeDeltas.length === 0 && !loading">
                <i class="fas fa-history"></i>
                <p>No updates found for this quarter.</p>
            </div>
            <div class="loading-state" *ngIf="loading">
                <div class="spinner"></div>
                <p>Loading Update History...</p>
            </div>
        </div>

        <!-- Article Viewer -->
        <div class="article-viewer" *ngIf="viewingArticle">
            <div class="viewer-header">
                <button class="close-btn" (click)="closeArticle()">
                    <i class="fas fa-arrow-left"></i> Back to List
                </button>
                <div class="ai-toggle">
                    <span class="ai-label">AI Enhance</span>
                    <label class="switch">
                        <input type="checkbox" [checked]="aiEnhanced" (change)="toggleAiEnhancement()"
                            [disabled]="enhancing">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <div class="viewer-content">
                <div *ngIf="loadingArticle" class="loading-article">
                    <div class="cyber-spinner"></div>
                    <p>{{ loadingMessage }}</p>
                </div>

                <div *ngIf="!loadingArticle" class="article-body" [innerHTML]="articleContent"
                    (click)="handleArticleClick($event)"></div>

                <!-- Labor Data Display -->
                <div *ngIf="laborData && !loadingArticle" class="labor-data-panel">
                    <h3>Labor Operation: {{ laborData.mainOperation.code }}</h3>
                    <div class="labor-details">
                        <div class="labor-row">
                            <span>Description:</span>
                            <strong>{{ laborData.mainOperation.description }}</strong>
                        </div>
                        <div class="labor-row">
                            <span>Time:</span>
                            <strong class="highlight-cyan">{{ laborData.mainOperation.time }} Hours</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FAB Search -->
    <button class="fab-search" (click)="toggleSearchSheet()">
        <i class="fas fa-search"></i>
        <span class="fab-label">Search</span>
    </button>

    <!-- Bottom Search Sheet -->
    <div class="bottom-search-sheet" [class.active]="showSearchSheet">
        <div class="search-header">
            <h3>Global Search</h3>
            <button class="close-sheet" (click)="toggleSearchSheet()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-input-wrapper">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="bottom-search-input" placeholder="Search procedures, parts, specs..."
                [(ngModel)]="searchQuery" (ngModelChange)="onSearchInput()">
        </div>
    </div>

    <!-- Backdrop for Search Sheet -->
    <div class="sheet-backdrop" *ngIf="showSearchSheet" (click)="toggleSearchSheet()"></div>
    <!-- Image Lightbox -->
    <div class="lightbox-overlay" *ngIf="expandedImage" (click)="closeImage()">
        <div class="lightbox-content" (click)="$event.stopPropagation()">
            <button class="close-lightbox" (click)="closeImage()">
                <i class="fas fa-times"></i>
            </button>
            <img [src]="expandedImage.src" [alt]="expandedImage.alt">
            <p class="lightbox-caption" *ngIf="expandedImage.alt">{{ expandedImage.alt }}</p>
        </div>
    </div>
</div>