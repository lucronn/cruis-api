<div class="docs-container">
    <!-- HUD Header -->
    <div class="hud-header" [class.collapsed]="searchFocused || showSearch">
        <div class="hud-top-row">

            <h1 class="vehicle-title">{{ vehicleName }}</h1>
            <div class="mini-car-wrapper" #miniCarContainer></div>
        </div>



        <!-- Stat Carousel (Collapsible) -->
        <div class="stat-carousel" [class.hidden]="searchFocused || searchQuery">
            <div class="stat-card" *ngFor="let stat of hudStats">
                <span class="stat-icon">{{ stat.icon }}</span>
                <div class="stat-info">
                    <span class="stat-label">{{ stat.label }}</span>
                    <span class="stat-value">{{ stat.value }}</span>
                </div>
            </div>
            <!-- Loading State for Stats -->
            <div class="stat-card loading" *ngIf="loadingHud">
                <div class="skeleton-line"></div>
                <div class="skeleton-line short"></div>
            </div>
        </div>
    </div>

    <!-- Thumb Zone Navigation (Pills) -->
    <div class="pill-nav-container">
        <div class="pill-scroll-wrapper">
            <button class="nav-pill" *ngFor="let pill of pillFilters" [class.active]="activePill === pill"
                (click)="selectPill(pill)">
                {{ pill }}
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="content-area">
        <!-- Unified Universal List -->
        <div class="universal-list" *ngIf="!viewingArticle && !loading && items.length > 0">
            <div class="universal-card" *ngFor="let item of items" [class.expanded]="item.expanded"
                [attr.data-type]="item.type">

                <!-- Card Header -->
                <div class="card-header" (click)="handleCardClick(item)">
                    <div class="header-main">
                        <div class="card-icon-wrapper" *ngIf="item.icon || item.badge">
                            <i class="fas" [ngClass]="item.icon" *ngIf="item.icon"></i>
                            <span class="badge" *ngIf="item.badge">{{ item.badge }}</span>
                        </div>
                        <div class="card-content">
                            <div class="meta-row" *ngIf="item.label || item.meta">
                                <span class="label-code" *ngIf="item.label">{{ item.label }}</span>
                                <span class="meta-info" *ngIf="item.meta">{{ item.meta }}</span>
                            </div>
                            <h3 class="title">{{ item.title }}</h3>
                            <p class="subtitle" *ngIf="item.subtitle">{{ item.subtitle }}</p>
                        </div>
                    </div>
                    <div class="header-action" *ngIf="item.type === 'article'">
                        <i class="fas fa-chevron-down expand-icon"></i>
                    </div>
                </div>

                <!-- Media (Wiring) -->
                <div class="card-media" *ngIf="item.type === 'wiring' && item.image"
                    (click)="expandImage(item.image, item.title)">
                    <img [src]="item.image" alt="Diagram">
                    <div class="overlay"><i class="fas fa-search-plus"></i></div>
                </div>

                <!-- Expanded Body (Article) -->
                <div class="card-body" *ngIf="item.expanded && item.type === 'article'">
                    <div class="quick-info-grid" *ngIf="item.originalData.torqueSpecs || item.originalData.partNumber">
                        <div class="info-item" *ngIf="item.originalData.torqueSpecs">
                            <span class="info-label">Torque:</span>
                            <span class="info-value">{{ item.originalData.torqueSpecs }}</span>
                        </div>
                        <div class="info-item" *ngIf="item.originalData.partNumber">
                            <span class="info-label">Part #:</span>
                            <span class="info-value">{{ item.originalData.partNumber }}</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn primary" (click)="viewArticle(item.originalData)">
                            <i class="fas fa-eye"></i> VIEW
                        </button>

                    </div>
                </div>

                <!-- Actions (DTC/TSB) -->
                <div class="card-actions" *ngIf="item.type === 'dtc' || item.type === 'tsb'">
                    <button class="action-btn small" (click)="viewArticle(item.originalData)">View Details</button>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="items.length === 0 && !loading && !viewingArticle">
            <i class="fas fa-search"></i>
            <p>No items found.</p>
        </div>

        <!-- Loading State -->
        <div class="loading-state" *ngIf="loading">
            <div class="spinner"></div>
            <p>Loading data...</p>
        </div>

        <!-- Article Viewer -->
        <div class="article-viewer" *ngIf="viewingArticle">
            <div class="viewer-header">
                <button class="close-btn" (click)="closeArticle()">
                    <i class="fas fa-arrow-left"></i> Back to List
                </button>
                <div class="ai-toggle">
                    <span class="ai-label">AI Enhance</span>
                    <label class="switch">
                        <input type="checkbox" [checked]="aiEnhanced" (change)="toggleAiEnhancement()"
                            [disabled]="enhancing">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <div class="viewer-content">
                <div *ngIf="loadingArticle" class="loading-article">
                    <div class="cyber-spinner"></div>
                    <p>{{ loadingMessage }}</p>
                </div>

                <div *ngIf="!loadingArticle" class="article-body" [innerHTML]="articleContent"
                    (click)="handleArticleClick($event)"></div>

                <!-- Labor Data Display -->
                <div *ngIf="laborData && !loadingArticle" class="labor-data-panel">
                    <h3>Labor Operation: {{ laborData.mainOperation.code }}</h3>
                    <div class="labor-details">
                        <div class="labor-row">
                            <span>Description:</span>
                            <strong>{{ laborData.mainOperation.description }}</strong>
                        </div>
                        <div class="labor-row">
                            <span>Time:</span>
                            <strong class="highlight-cyan">{{ laborData.mainOperation.time }} Hours</strong>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>




    <!-- Sticky Search Overlay -->
    <div class="sticky-search-overlay" *ngIf="showSearch" [@slideDown]>
        <div class="search-bar-sticky">
            <button class="back-btn" (click)="closeSearch()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="search-input-container">
                <i class="fas fa-search search-icon"></i>
                <input #searchInput type="text" placeholder="Search procedures, specs, wiring..."
                    [(ngModel)]="searchQuery" (ngModelChange)="onSearchInput()" autofocus>
            </div>
            <button *ngIf="searchQuery" class="clear-btn" (click)="clearSearch()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-results-info" *ngIf="searchQuery">
            <span>{{ filteredArticles.length }} results</span>
        </div>
    </div>






    <!-- Image Lightbox -->
    <div class="lightbox-overlay" *ngIf="expandedImage" (click)="closeImage()">
        <div class="lightbox-content" (click)="$event.stopPropagation()">
            <button class="close-lightbox" (click)="closeImage()">
                <i class="fas fa-times"></i>
            </button>

            <!-- Zoom Controls -->
            <div class="zoom-controls">
                <button class="zoom-btn" (click)="zoomIn()" title="Zoom In">
                    <i class="fas fa-search-plus"></i>
                </button>
                <span class="zoom-level">{{ imageZoom }}%</span>
                <button class="zoom-btn" (click)="zoomOut()" title="Zoom Out">
                    <i class="fas fa-search-minus"></i>
                </button>
                <button class="zoom-btn" (click)="resetZoom()" title="Reset Zoom">
                    <i class="fas fa-compress-arrows-alt"></i>
                </button>
            </div>

            <!-- Image Container with Pan -->
            <div class="image-container" (mousedown)="startPan($event)" (wheel)="onMouseWheel($event)">
                <img [src]="expandedImage.src" [alt]="expandedImage.alt"
                    [style.transform]="'scale(' + (imageZoom / 100) + ') translate(' + imagePanX + 'px, ' + imagePanY + 'px)'"
                    [style.cursor]="imageZoom > 100 ? 'grab' : 'default'">
            </div>

            <p class="lightbox-caption" *ngIf="expandedImage.alt">{{ expandedImage.alt }}</p>
            <p class="lightbox-hint">Use mouse wheel or buttons to zoom â€¢ Click and drag to pan</p>
        </div>
    </div>
</div>